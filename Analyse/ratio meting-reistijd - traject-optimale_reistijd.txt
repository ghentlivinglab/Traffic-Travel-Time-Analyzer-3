select traject_id, provider_id, providers.naam, trajecten.optimale_reistijd, avg(reistijd), avg(reistijd)/trajecten.optimale_reistijd as ratio from metingen
inner join providers on providers.id = metingen.provider_id
inner join trajecten on trajecten.id = metingen.traject_id
where reistijd is not null and reistijd >= 0
group by provider_id, traject_id
ORDER BY `ratio`  DESC;
select r.traject_id, max(r.ratio) - min(r.ratio) ratiodiff
from (select traject_id, provider_id, providers.naam, trajecten.optimale_reistijd, avg(reistijd), avg(reistijd)/trajecten.optimale_reistijd as ratio from metingen
inner join providers on providers.id = metingen.provider_id
inner join trajecten on trajecten.id = metingen.traject_id
where reistijd is not null and reistijd >= 0
group by provider_id, traject_id) r
group by r.traject_id;